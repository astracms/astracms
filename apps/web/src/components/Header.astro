---
import { SITE } from "@/lib/constants";
import Container from "./Container.astro";
import WordMark from "./icons/WordMark.astro";
---

<header
  id="header"
  class="sticky top-0 z-50 w-full bg-background/80 backdrop-blur-xl border-b border-border/50"
>
  <Container>
    <div class="flex h-16 items-center justify-between">
      <!-- Logo -->
      <a
        href="/"
        class="flex items-center gap-2 transition-opacity duration-300 hover:opacity-70"
      >
        <WordMark/>
        <span class="sr-only">astracms</span>
      </a>

      <!-- Desktop Nav -->
      <nav class="hidden md:flex items-center gap-8">
        <a
          href="https://docs.astracms.dev"
          target="_blank"
          rel="noopener"
          class="text-sm text-muted-foreground transition-colors duration-300 hover:text-foreground"
        >
          Docs
        </a>
        <a
          href="/pricing"
          class="text-sm text-muted-foreground transition-colors duration-300 hover:text-foreground"
        >
          Pricing
        </a>
        <a
          href="/blog"
          class="text-sm text-muted-foreground transition-colors duration-300 hover:text-foreground"
        >
          Blog
        </a>
      </nav>

      <!-- Right Side -->
      <div class="hidden md:flex items-center gap-3">
        <a
          href={`${SITE.APP_URL}/login`}
          class="inline-flex h-9 items-center justify-center px-4 text-sm text-muted-foreground transition-colors duration-300 hover:text-foreground"
        >
          Sign in
        </a>
        <a
          href={`${SITE.APP_URL}/register`}
          class="inline-flex h-9 items-center justify-center rounded-lg bg-foreground px-4 text-sm font-medium text-background shadow-sm transition-all duration-300 hover:bg-foreground/90 hover:shadow-md"
        >
          Get Started
        </a>
      </div>

      <!-- Mobile Nav Toggle -->
      <button
        id="toggle"
        class="md:hidden flex flex-col justify-center gap-1.5 size-10 items-center rounded-lg hover:bg-muted/80 transition-colors duration-300"
        aria-label="Toggle mobile menu"
      >
        <span
          id="bar1"
          class="h-0.5 w-5 bg-foreground transition-all duration-300 origin-center"
        ></span>
        <span
          id="bar2"
          class="h-0.5 w-5 bg-foreground transition-all duration-300 origin-center"
        ></span>
      </button>
    </div>
  </Container>

  <!-- Mobile Nav Menu -->
  <div
    id="mobile-nav"
    class="fixed inset-x-0 top-16 bottom-0 z-40 bg-background hidden data-[state=open]:flex flex-col border-t border-border/50"
  >
    <nav class="flex bg-background flex-col p-6 gap-1 animate-fade-in">
      <a
        href="https://docs.astracms.dev"
        target="_blank"
        rel="noopener"
        class="py-3 text-lg transition-colors duration-300 hover:text-muted-foreground"
      >
        Docs
      </a>
      <a
        href="/pricing"
        class="py-3 text-lg transition-colors duration-300 hover:text-muted-foreground"
      >
        Pricing
      </a>
      <a
        href="/blog"
        class="py-3 text-lg transition-colors duration-300 hover:text-muted-foreground"
      >
        Blog
      </a>
      <hr class="border-border/50 my-3">
      <a
        href={`${SITE.APP_URL}/login`}
        class="py-3 text-lg transition-colors duration-300 hover:text-muted-foreground"
      >
        Sign in
      </a>
      <a
        href={`${SITE.APP_URL}/register`}
        class="inline-flex h-11 items-center justify-center rounded-lg bg-foreground px-6 text-base font-medium text-background mt-2 transition-all duration-300 hover:bg-foreground/90"
      >
        Get Started
      </a>
    </nav>
  </div>
</header>

<script>
  function initMobileNav() {
    const toggle = document.getElementById("toggle");
    const nav = document.getElementById("mobile-nav");
    const bar1 = document.getElementById("bar1");
    const bar2 = document.getElementById("bar2");

    let isOpen = false;

    const toggleNav = () => {
      isOpen = !isOpen;

      if (isOpen) {
        nav?.setAttribute("data-state", "open");
        document.body.style.overflow = "hidden";

        // Animate burger to X
        bar1?.classList.add("rotate-45", "translate-y-[4px]");
        bar2?.classList.add("-rotate-45", "-translate-y-[4px]");
      } else {
        nav?.setAttribute("data-state", "closed");
        document.body.style.overflow = "";

        // Animate X back to burger
        bar1?.classList.remove("rotate-45", "translate-y-[4px]");
        bar2?.classList.remove("-rotate-45", "-translate-y-[4px]");
      }
    };

    toggle?.addEventListener("click", toggleNav);
  }

  // Initialize on first load
  initMobileNav();

  // Re-initialize after page transitions (Astro View Transitions)
  document.addEventListener("astro:after-swap", initMobileNav);
</script>
