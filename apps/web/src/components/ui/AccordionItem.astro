---
type Props = {
  open?: boolean;
  title: string;
  name?: string;
  class?: string;
};

const { open, title, name, class: className } = Astro.props;
---

<details
  data-accordion-item
  class:list={["accordion-item group", className]}
  name={name}
  open={open}
>
  <summary
    class="accordion-item-title py-5 flex items-center justify-between gap-4 cursor-pointer text-base font-medium leading-normal list-none transition-colors duration-300 m-0 hover:text-muted-foreground"
  >
    <span class="transition-colors duration-300">{title}</span>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="1.5"
      stroke="currentColor"
      class="size-4 text-muted-foreground transition-transform duration-300 ease-premium group-open:rotate-45 shrink-0"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M12 4.5v15m7.5-7.5h-15"></path>
    </svg>
  </summary>
  <div class="pb-5">
    <slot />
  </div>
</details>

<style>
  .accordion-item {
    height: var(--accordion-item-collapsed);
    overflow: hidden;

    &[open] {
      height: var(--accordion-item-expanded);
    }

    &.accordion-item--animated {
      transition: height 0.25s cubic-bezier(0.16, 1, 0.3, 1);
    }
  }

  .accordion-item-title {
    &::marker,
    &::-webkit-details-marker {
      display: none;
    }
  }
</style>

<script>
  import {
    handleResize,
    hasViewportWidthChanged,
    setAccordionHeight,
  } from "@/lib/accordion";

  document.addEventListener("astro:page-load", () => {
    const accordions = document.querySelectorAll<HTMLDetailsElement>(
      "[data-accordion-item]",
    );
    setAccordionHeight(accordions);

    handleResize(() => {
      if (hasViewportWidthChanged()) {
        setAccordionHeight(accordions);
      }
    });
  });
</script>
